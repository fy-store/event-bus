"use strict";var A=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)};var s=(e,t,r)=>(A(e,t,"read from private field"),r?r.call(e):t.get(e)),m=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},U=(e,t,r,o)=>(A(e,t,"write to private field"),o?o.call(e,r):t.set(e,r),r);var T=(e,t,r)=>(A(e,t,"access private method"),r);var tt=typeof global=="object"&&global&&global.Object===Object&&global,lt=typeof self=="object"&&self&&self.Object===Object&&self,f=tt||lt||Function("return this")(),g=f.Symbol,et=Object.prototype,ft=et.hasOwnProperty,ut=et.toString,w=g?g.toStringTag:void 0;function bt(e){var t=ft.call(e,w),r=e[w];try{e[w]=void 0;var o=!0}catch{}var n=ut.call(e);return o&&(t?e[w]=r:delete e[w]),n}var ht=Object.prototype,yt=ht.toString;function pt(e){return yt.call(e)}var dt="[object Null]",gt="[object Undefined]",K=g?g.toStringTag:void 0;function k(e){return e==null?e===void 0?gt:dt:K&&K in Object(e)?bt(e):pt(e)}function rt(e){return e!=null&&typeof e=="object"}function nt(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var vt="[object AsyncFunction]",mt="[object Function]",wt="[object GeneratorFunction]",jt="[object Proxy]";function Et(e){if(!nt(e))return!1;var t=k(e);return t==mt||t==wt||t==vt||t==jt}var _=f["__core-js_shared__"],D=function(){var e=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function St(e){return!!D&&D in e}var Tt=Function.prototype,Ot=Tt.toString;function y(e){if(e!=null){try{return Ot.call(e)}catch{}try{return e+""}catch{}}return""}var xt=/[\\^$.*+?()[\]{}|]/g,kt=/^\[object .+?Constructor\]$/,Pt=Function.prototype,At=Object.prototype,_t=Pt.toString,It=At.hasOwnProperty,$t=RegExp("^"+_t.call(It).replace(xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Rt(e){if(!nt(e)||St(e))return!1;var t=Et(e)?$t:kt;return t.test(y(e))}function Ft(e,t){return e==null?void 0:e[t]}function p(e,t){var r=Ft(e,t);return Rt(r)?r:void 0}var $=p(f,"WeakMap");(function(){try{var e=p(Object,"defineProperty");return e({},"",{}),e}catch{}})();var Wt="[object Arguments]";function G(e){return rt(e)&&k(e)==Wt}var ot=Object.prototype,Bt=ot.hasOwnProperty,Mt=ot.propertyIsEnumerable;G(function(){return arguments}());var it=typeof exports=="object"&&exports&&!exports.nodeType&&exports,H=it&&typeof module=="object"&&module&&!module.nodeType&&module,Ut=H&&H.exports===it,V=Ut?f.Buffer:void 0;V&&V.isBuffer;var st=typeof exports=="object"&&exports&&!exports.nodeType&&exports,E=st&&typeof module=="object"&&module&&!module.nodeType&&module,Kt=E&&E.exports===st,I=Kt&&tt.process,v=function(){try{var e=E&&E.require&&E.require("util").types;return e||I&&I.binding&&I.binding("util")}catch{}}();v&&v.isTypedArray;p(Object,"create");var R=p(f,"Map"),ct=typeof exports=="object"&&exports&&!exports.nodeType&&exports,q=ct&&typeof module=="object"&&module&&!module.nodeType&&module,Dt=q&&q.exports===ct,z=Dt?f.Buffer:void 0;z&&z.allocUnsafe;var F=p(f,"DataView"),W=p(f,"Promise"),B=p(f,"Set"),C="[object Map]",Gt="[object Object]",L="[object Promise]",Q="[object Set]",Y="[object WeakMap]",J="[object DataView]",Ht=y(F),Vt=y(R),qt=y(W),zt=y(B),Ct=y($),d=k;(F&&d(new F(new ArrayBuffer(1)))!=J||R&&d(new R)!=C||W&&d(W.resolve())!=L||B&&d(new B)!=Q||$&&d(new $)!=Y)&&(d=function(e){var t=k(e),r=t==Gt?e.constructor:void 0,o=r?y(r):"";if(o)switch(o){case Ht:return J;case Vt:return C;case qt:return L;case zt:return Q;case Ct:return Y}return t});f.Uint8Array;var X=g?g.prototype:void 0;X&&X.valueOf;v&&v.isMap;v&&v.isSet;const b=e=>e===null?"null":Array.isArray(e)?"array":typeof e,Lt=Symbol("只读代理标识"),O=Symbol("代理数据:只读"),Qt=Symbol("解除只读代理包装"),Yt=Symbol("克隆数据只读代理数据"),j=(e,t="default")=>{let r={};const o=b(t);if(o==="string")Z(t),r={mode:t,unReadOnly:!1,repeatReadOnly:!1};else if(o==="object"){let n=t.mode;n===void 0&&(n="default"),Z(n),r.mode=n,r.unReadOnly=!!t.unReadOnly,r.repeatReadOnly=!!t.repeatReadOnly,r.sign=t.sign}else throw new TypeError('"options" must be a string or object');return Zt(e)&&!r.repeatReadOnly?e:new Proxy(e,{get(n,i){if(i===O)return O;if(i===Lt)return r.sign;if(i===Yt)return n;if(i===Qt){if(r.unReadOnly)return n;throw new Error('The current data "options.unReadOnly" is false !')}const a=b(n[i]);return a==="function"?r.mode==="default"?n[i]===Array.prototype[Symbol.iterator]?j(n[i],t):j(n[i].bind(Jt),t):j(n[i].bind(n),t):a==="object"||a==="array"?j(n[i],t):n[i]},set(n){return console.warn(n,"The current data is read-only !"),!0},deleteProperty(n){return console.warn(n,"The current data is read-only !"),!0},apply(n,i,a){return r.mode==="strict"?(console.warn(n,'The current data configuration "options.mode" is "strict" , "strict" mode prohibit calling functions !'),!1):typeof r.mode=="function"&&!r.mode(n,i,a)?!1:n.apply(i,a)}})},Z=e=>{const t=b(e),r=new TypeError('"options.mode" must be a "strict" | "default" | "looseFitting" | function !');if(t==="string"){if(!["strict","default","looseFitting"].includes(e))throw r;return}if(t!=="function")throw r},Jt=new Proxy({},{set(e,t){return console.warn(t,'The current data configuration "options.mode" is "default" , cannot be changed data through "this" !'),!0}}),Xt=["object","array","function"],Zt=e=>{const t=b(e);return!(!Xt.includes(t)||e[O]!==O)},N={object:(e,t)=>{if(!e.callback)throw new Error('"EventItem.callback" does not exist');return[{once:!!e.once,sign:Symbol(t.toString()),callback:e.callback}]},function:(e,t)=>[{once:!1,sign:Symbol(t.toString()),callback:e}],array:(e,t)=>e.map(r=>{if(typeof r=="function"&&(r={once:!1,sign:Symbol(t.toString()),callback:r}),b(r)!=="object")throw new Error('"events" item must be a EventItem');if(typeof r.callback!="function")throw new Error('"EventItem.callback" must be a function');return{once:!!r.once,sign:Symbol(t.toString()),callback:r.callback}})};var h,c,S,M,x,at;class Nt{constructor(t={}){m(this,S);m(this,x);m(this,h,void 0);m(this,c,new Map);if(b(t)!=="object")throw new TypeError('"options" must be a object');const{state:r={},events:o={},ctx:n}=t;if(b(r)!=="object")throw new TypeError('"state" must be a object');if(b(o)!=="object")throw new TypeError('"events" must be a object');U(this,h,r);const i=a=>{let l=o[a];const u=b(l);if(!N[u])throw new TypeError('"events" item must be `EventItem`  or `EventItem[]` or `function`');const P=N[u].call(this,l,a);s(this,c).set(a,P)};if(Object.keys(o).forEach(i),Object.getOwnPropertySymbols(o).forEach(i),n){const a={eventBus:this,on:this.on.bind(this),once:this.once.bind(this),has:this.has.bind(this),hasSign:this.hasSign.bind(this),hasEvent:this.hasEvent.bind(this),emit:this.emit.bind(this),off:this.off.bind(this),removeEvent:T(this,x,at).bind(this),state:s(this,h),events:s(this,c)};n.call(this,a)}}get state(){return s(this,h)}get __events__(){return j(s(this,c),"strict")}on(t,r,o){return T(this,S,M).call(this,t,!1,r,o)}once(t,r,o){return T(this,S,M).call(this,t,!0,r,o)}hasSign(t){const r=s(this,c).entries();for(const[,o]of r)if(o.findIndex(i=>i.sign===t)!==-1)return!0;return console.error(`Warning: off => "${String(t)}" does not exist`),!1}has(t,r){if(!(typeof t=="string"||typeof t=="symbol"))throw new TypeError('TypeError: "eventName" must be a string or symbol');if(typeof r!="function")throw new TypeError('TypeError: "callback" must be a function');if(!s(this,c).has(t))return!1;const o=s(this,c).get(t);return o.length===0?!1:!!o.find(n=>n.callback)}hasEvent(t){if(!(typeof t=="string"||typeof t=="symbol"))throw new TypeError('TypeError: "eventName" must be a string or symbol');return s(this,c).has(t)?s(this,c).get(t).length!==0:!1}emit(t,...r){if(!s(this,c).has(t)){const n=s(this,c).entries();for(const[i,a]of n){const l=a.findIndex(u=>u.sign===t);if(l!==-1)return a[l].callback.call(this,s(this,h),...r),a[l].once&&(a.splice(l,1),a.length===0&&s(this,c).delete(i)),!0}return console.error(`Warning: emit => "${String(t)}" does not exist`),!1}const o=s(this,c).get(t);for(let n=0;n<o.length;n++){const i=o[n];i.callback.call(this,s(this,h),...r),i.once&&(o.splice(n,n+1),n--)}return o.length===0&&s(this,c).delete(t),!0}off(...t){if(!t.length)throw new Error("No parameters passed !");const[r,o]=t;if(t.length===1){const n=s(this,c).entries();let i=!1;for(const[a,l]of n){const u=l.findIndex(P=>P.sign===r);if(u!==-1){i=!0,l.splice(u,1),l.length===0&&s(this,c).delete(a);break}}if(!i)return console.error(`Warning: off => "${String(r)}" does not exist`),!1}else{if(!s(this,c).has(r))return console.error(`Warning: off => "${String(r)}" does not exist`),!1;const n=s(this,c).get(r),i=n.findIndex(l=>l.callback===o);if(i===-1)return console.error('Warning: off => this "callback" does not exist'),!1;n.splice(i,1);let a=!0;for(;a;){const l=n.findIndex(u=>u.callback===o);if(l===-1){a=!1;break}n.splice(l,1)}n.length===0&&s(this,c).delete(r)}return!0}}h=new WeakMap,c=new WeakMap,S=new WeakSet,M=function(t,r,o,n=""){if(!(typeof t=="string"||typeof t=="symbol"))throw new TypeError('TypeError: "eventName" must be a string or symbol');if(typeof o!="function")throw new TypeError('TypeError: "callback" must be a function');if(typeof n!="string")throw new TypeError('TypeError: "desc" must be a string');s(this,c).has(t)||s(this,c).set(t,[]);const i=Symbol(n||t.toString());return s(this,c).get(t).push({once:r,sign:i,callback:o}),i},x=new WeakSet,at=function(t){return s(this,c).has(t)?s(this,c).delete(t):(console.error(`Warning: removeEvent => "${String(t)}" does not exist`),!1)};module.exports=Nt;
